services:
  - type: web
    name: bgs-ai-bot
    env: python
    plan: free
    buildCommand: |
      sudo apt-get update
      sudo apt-get install -y tesseract-ocr tesseract-ocr-chi-sim tesseract-ocr-chi-tra
      pip install --no-cache-dir -r requirements.txt
    startCommand: gunicorn app:app --bind 0.0.0.0:$PORT --workers 1 --threads 8 --timeout 120
    envVars:
      - key: LINE_CHANNEL_ACCESS_TOKEN
        sync: false
      - key: LINE_CHANNEL_SECRET
        sync: false
      - key: DEBUG_VISION
        value: "1"
      - key: TESSERACT_CMD
        value: "/usr/bin/tesseract"
      - key: MIN_SEQ
        value: "5"
      - key: ALT_WINDOW
        value: "20"
      - key: ALT_THRESH
        value: "0.70"
      - key: ALT_STRICT_STREAK
        value: "5"
      - key: TEMP
        value: "0.95"
      - key: ENSEMBLE_WEIGHTS
        value: "rule:0.7,rnn:0.3"
      - key: PYTHONPATH
        value: "/opt/render/project/src"
      - key: PIP_NO_CACHE_DIR
        value: "yes"
    healthCheckPath: /health
