services:
  - type: web
    name: bgs-ai-bot
    env: python
    plan: free
    buildCommand: |
      sudo apt-get update
      sudo apt-get install -y tesseract-ocr tesseract-ocr-chi-sim tesseract-ocr-chi-tra
      pip install -r requirements.txt
    startCommand: gunicorn app:app --bind 0.0.0.0:$PORT --workers 1 --threads 8 --timeout 120
    envVars:
      - key: LINE_CHANNEL_ACCESS_TOKEN
        sync: false
      - key: LINE_CHANNEL_SECRET
        sync: false
      - key: DEBUG_VISION
        value: "1"
      - key: TESSERACT_CMD
        value: "/usr/bin/tesseract"
      - key: FOCUS_ROI
        value: "0.2,0.3,0.6,0.5"
      # 以下是可选的机器学习相关环境变量
      - key: MIN_SEQ
        value: "5"
      - key: ALT_WINDOW
        value: "20"
      - key: ALT_THRESH
        value: "0.70"
      - key: ALT_STRICT_STREAK
        value: "5"
      - key: TEMP
        value: "0.95"
      - key: ENSEMBLE_WEIGHTS_TREND
        value: "xgb:0.45,lgb:0.35,rnn:0.20"
      - key: ENSEMBLE_WEIGHTS_CHOP
        value: "xgb:0.20,lgb:0.25,rnn:0.55"
    healthCheckPath: /health
